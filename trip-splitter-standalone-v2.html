<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trip Expense Splitter</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; padding: 0; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        // Lucide icons as simple SVG components
        const Trash2 = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"/>
            </svg>
        );

        const Plus = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/>
            </svg>
        );

        const Users = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M17 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2M9 11a4 4 0 100-8 4 4 0 000 8zM23 21v-2a4 4 0 00-3-3.87M16 3.13a4 4 0 010 7.75"/>
            </svg>
        );

        const DollarSign = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 000 7h5a3.5 3.5 0 010 7H6"/>
            </svg>
        );

        const Receipt = () => (
            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1z"/>
                <path d="M16 8h-6M16 12h-6M16 16h-6"/>
            </svg>
        );

        const Download = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
            </svg>
        );

        function TripExpenseSplitter() {
            const [friends, setFriends] = useState(['Alice', 'Bob', 'Charlie']);
            const [newFriend, setNewFriend] = useState('');
            const [expenses, setExpenses] = useState([]);
            const [newExpense, setNewExpense] = useState({
                description: '',
                amount: '',
                paidBy: '',
                splitBetween: []
            });

            const calculateBalances = () => {
                const balances = {};
                friends.forEach(friend => balances[friend] = 0);

                expenses.forEach(expense => {
                    const amount = parseFloat(expense.amount);
                    const splitCount = expense.splitBetween.length;
                    const perPersonShare = amount / splitCount;

                    balances[expense.paidBy] += amount;
                    expense.splitBetween.forEach(person => {
                        balances[person] -= perPersonShare;
                    });
                });

                return balances;
            };

            const calculateTotalSpent = () => {
                const totalSpent = {};
                friends.forEach(friend => totalSpent[friend] = 0);

                expenses.forEach(expense => {
                    totalSpent[expense.paidBy] += parseFloat(expense.amount);
                });

                return totalSpent;
            };

            const calculateSpentOnOthers = () => {
                const spentOnOthers = {};
                friends.forEach(friend => {
                    spentOnOthers[friend] = {};
                    friends.forEach(f => {
                        if (f !== friend) spentOnOthers[friend][f] = 0;
                    });
                });

                expenses.forEach(expense => {
                    const amount = parseFloat(expense.amount);
                    const splitCount = expense.splitBetween.length;
                    const perPersonShare = amount / splitCount;
                    const payer = expense.paidBy;

                    expense.splitBetween.forEach(person => {
                        if (person !== payer) {
                            spentOnOthers[payer][person] += perPersonShare;
                        }
                    });
                });

                return spentOnOthers;
            };

            const calculateSettlements = () => {
                const balances = calculateBalances();
                const settlements = [];
                
                const debtors = [];
                const creditors = [];

                Object.entries(balances).forEach(([person, balance]) => {
                    if (balance < -0.01) {
                        debtors.push({ person, amount: -balance });
                    } else if (balance > 0.01) {
                        creditors.push({ person, amount: balance });
                    }
                });

                debtors.sort((a, b) => b.amount - a.amount);
                creditors.sort((a, b) => b.amount - a.amount);

                let i = 0, j = 0;
                while (i < debtors.length && j < creditors.length) {
                    const debtor = debtors[i];
                    const creditor = creditors[j];
                    const amount = Math.min(debtor.amount, creditor.amount);

                    settlements.push({
                        from: debtor.person,
                        to: creditor.person,
                        amount: amount.toFixed(2)
                    });

                    debtor.amount -= amount;
                    creditor.amount -= amount;

                    if (debtor.amount < 0.01) i++;
                    if (creditor.amount < 0.01) j++;
                }

                return settlements;
            };

            const addFriend = () => {
                if (newFriend.trim() && !friends.includes(newFriend.trim())) {
                    setFriends([...friends, newFriend.trim()]);
                    setNewFriend('');
                }
            };

            const removeFriend = (friendToRemove) => {
                setFriends(friends.filter(f => f !== friendToRemove));
                setExpenses(expenses.filter(e => 
                    e.paidBy !== friendToRemove && !e.splitBetween.includes(friendToRemove)
                ));
            };

            const addExpense = () => {
                if (newExpense.description && newExpense.amount && newExpense.paidBy && newExpense.splitBetween.length > 0) {
                    setExpenses([...expenses, {
                        id: Date.now(),
                        ...newExpense,
                        amount: parseFloat(newExpense.amount)
                    }]);
                    setNewExpense({
                        description: '',
                        amount: '',
                        paidBy: '',
                        splitBetween: []
                    });
                }
            };

            const removeExpense = (id) => {
                setExpenses(expenses.filter(e => e.id !== id));
            };

            const toggleSplitPerson = (person) => {
                const current = newExpense.splitBetween;
                if (current.includes(person)) {
                    setNewExpense({
                        ...newExpense,
                        splitBetween: current.filter(p => p !== person)
                    });
                } else {
                    setNewExpense({
                        ...newExpense,
                        splitBetween: [...current, person]
                    });
                }
            };

            const balances = calculateBalances();
            const settlements = calculateSettlements();
            const totalExpenses = expenses.reduce((sum, e) => sum + e.amount, 0);
            const totalSpent = calculateTotalSpent();
            const spentOnOthers = calculateSpentOnOthers();

            const exportToCSV = () => {
                let csvContent = "Trip Expense Splitter - Summary Report\n\n";
                
                // Friends list
                csvContent += "FRIENDS\n";
                csvContent += friends.join(", ") + "\n\n";
                
                // Total spent by each person
                csvContent += "TOTAL MONEY SPENT BY EACH PERSON\n";
                csvContent += "Person,Total Spent (â‚¹)\n";
                Object.entries(totalSpent).forEach(([person, amount]) => {
                    csvContent += `"${person}",${amount.toFixed(2)}\n`;
                });
                csvContent += "\n";
                
                // Spent on others breakdown
                csvContent += "SPENT ON OTHERS BREAKDOWN\n";
                csvContent += "Payer,Beneficiary,Amount (â‚¹)\n";
                Object.entries(spentOnOthers).forEach(([person, others]) => {
                    Object.entries(others).forEach(([otherPerson, amount]) => {
                        if (amount > 0) {
                            csvContent += `"${person}","${otherPerson}",${amount.toFixed(2)}\n`;
                        }
                    });
                });
                csvContent += "\n";
                
                // Expenses
                csvContent += "EXPENSES\n";
                csvContent += "Description,Amount (â‚¹),Paid By,Split Between\n";
                expenses.forEach(expense => {
                    csvContent += `"${expense.description}",${expense.amount},"${expense.paidBy}","${expense.splitBetween.join(', ')}"\n`;
                });
                csvContent += `\nTotal Expenses,â‚¹${totalExpenses.toFixed(2)}\n\n`;
                
                // Balances
                csvContent += "BALANCES\n";
                csvContent += "Person,Balance (â‚¹)\n";
                Object.entries(balances).forEach(([person, balance]) => {
                    csvContent += `"${person}",${balance.toFixed(2)}\n`;
                });
                csvContent += "\n";
                
                // Settlements
                csvContent += "SETTLEMENTS\n";
                csvContent += "From,To,Amount (â‚¹)\n";
                if (settlements.length === 0) {
                    csvContent += "All settled up!\n";
                } else {
                    settlements.forEach(settlement => {
                        csvContent += `"${settlement.from}","${settlement.to}",${settlement.amount}\n`;
                    });
                }
                
                // Create download
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `trip-expenses-${new Date().toISOString().split('T')[0]}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-4">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white rounded-lg shadow-lg p-6 mb-6">
                            <h1 className="text-3xl font-bold text-indigo-600 mb-2 flex items-center gap-2">
                                <Receipt />
                                Trip Expense Splitter
                            </h1>
                            <p className="text-gray-600">Track expenses and split bills with friends</p>
                            {expenses.length > 0 && (
                                <button
                                    onClick={exportToCSV}
                                    className="mt-4 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center gap-2"
                                >
                                    <Download /> Export to CSV
                                </button>
                            )}
                        </div>

                        <div className="grid md:grid-cols-2 gap-6">
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                                    <Users />
                                    Friends ({friends.length})
                                </h2>
                                <div className="flex gap-2 mb-4">
                                    <input
                                        type="text"
                                        value={newFriend}
                                        onChange={(e) => setNewFriend(e.target.value)}
                                        onKeyPress={(e) => e.key === 'Enter' && addFriend()}
                                        placeholder="Add friend name"
                                        className="flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    />
                                    <button
                                        onClick={addFriend}
                                        className="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700 flex items-center gap-2"
                                    >
                                        <Plus /> Add
                                    </button>
                                </div>
                                <div className="space-y-2">
                                    {friends.map(friend => (
                                        <div key={friend} className="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                                            <span className="font-medium">{friend}</span>
                                            <button
                                                onClick={() => removeFriend(friend)}
                                                className="text-red-500 hover:text-red-700"
                                            >
                                                <Trash2 />
                                            </button>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h2 className="text-xl font-semibold mb-4 flex items-center gap-2">
                                    <DollarSign />
                                    Add Expense
                                </h2>
                                <div className="space-y-3">
                                    <input
                                        type="text"
                                        value={newExpense.description}
                                        onChange={(e) => setNewExpense({...newExpense, description: e.target.value})}
                                        placeholder="Description (e.g., Dinner)"
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    />
                                    <input
                                        type="number"
                                        value={newExpense.amount}
                                        onChange={(e) => setNewExpense({...newExpense, amount: e.target.value})}
                                        placeholder="Amount (â‚¹)"
                                        step="0.01"
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    />
                                    <select
                                        value={newExpense.paidBy}
                                        onChange={(e) => setNewExpense({...newExpense, paidBy: e.target.value})}
                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                                    >
                                        <option value="">Who paid?</option>
                                        {friends.map(friend => (
                                            <option key={friend} value={friend}>{friend}</option>
                                        ))}
                                    </select>
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Split between:</label>
                                        <div className="flex flex-wrap gap-2">
                                            {friends.map(friend => (
                                                <button
                                                    key={friend}
                                                    onClick={() => toggleSplitPerson(friend)}
                                                    className={`px-3 py-1 rounded-full text-sm ${
                                                        newExpense.splitBetween.includes(friend)
                                                            ? 'bg-indigo-600 text-white'
                                                            : 'bg-gray-200 text-gray-700'
                                                    }`}
                                                >
                                                    {friend}
                                                </button>
                                            ))}
                                        </div>
                                    </div>
                                    <button
                                        onClick={addExpense}
                                        className="w-full bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 flex items-center justify-center gap-2"
                                    >
                                        <Plus /> Add Expense
                                    </button>
                                </div>
                            </div>
                        </div>

                        <div className="bg-white rounded-lg shadow-lg p-6 mt-6">
                            <h2 className="text-xl font-semibold mb-4">
                                Expenses (Total: â‚¹{totalExpenses.toFixed(2)})
                            </h2>
                            <div className="space-y-2">
                                {expenses.length === 0 ? (
                                    <p className="text-gray-500 text-center py-8">No expenses added yet</p>
                                ) : (
                                    expenses.map(expense => (
                                        <div key={expense.id} className="flex justify-between items-center bg-gray-50 p-4 rounded-lg">
                                            <div className="flex-1">
                                                <div className="font-medium">{expense.description}</div>
                                                <div className="text-sm text-gray-600">
                                                    Paid by {expense.paidBy} â€¢ Split: {expense.splitBetween.join(', ')}
                                                </div>
                                            </div>
                                            <div className="flex items-center gap-4">
                                                <span className="font-bold text-green-600">â‚¹{expense.amount.toFixed(2)}</span>
                                                <button
                                                    onClick={() => removeExpense(expense.id)}
                                                    className="text-red-500 hover:text-red-700"
                                                >
                                                    <Trash2 />
                                                </button>
                                            </div>
                                        </div>
                                    ))
                                )}
                            </div>
                        </div>

                        <div className="grid md:grid-cols-2 gap-6 mt-6">
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h2 className="text-xl font-semibold mb-4">Total Money Spent</h2>
                                <div className="space-y-2">
                                    {Object.entries(totalSpent).map(([person, amount]) => (
                                        <div key={person} className="flex justify-between items-center p-3 bg-blue-50 rounded-lg">
                                            <span className="font-medium">{person}</span>
                                            <span className="font-bold text-blue-600">
                                                â‚¹{amount.toFixed(2)}
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h2 className="text-xl font-semibold mb-4">Spent on Others Breakdown</h2>
                                <div className="space-y-3">
                                    {Object.entries(spentOnOthers).map(([person, others]) => {
                                        const hasSpending = Object.values(others).some(amt => amt > 0);
                                        if (!hasSpending) return null;
                                        return (
                                            <div key={person} className="p-3 bg-purple-50 rounded-lg">
                                                <div className="font-semibold text-purple-700 mb-2">{person} spent on:</div>
                                                <div className="ml-4 space-y-1">
                                                    {Object.entries(others).map(([otherPerson, amount]) => {
                                                        if (amount <= 0) return null;
                                                        return (
                                                            <div key={otherPerson} className="flex justify-between text-sm">
                                                                <span>{otherPerson}</span>
                                                                <span className="font-medium text-purple-600">â‚¹{amount.toFixed(2)}</span>
                                                            </div>
                                                        );
                                                    })}
                                                </div>
                                            </div>
                                        );
                                    })}
                                    {Object.values(spentOnOthers).every(others => Object.values(others).every(amt => amt === 0)) && (
                                        <p className="text-gray-500 text-center py-4">No cross-spending yet</p>
                                    )}
                                </div>
                            </div>
                        </div>

                        <div className="grid md:grid-cols-2 gap-6 mt-6">
                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h2 className="text-xl font-semibold mb-4">Balances</h2>
                                <div className="space-y-2">
                                    {Object.entries(balances).map(([person, balance]) => (
                                        <div key={person} className="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                            <span className="font-medium">{person}</span>
                                            <span className={`font-bold ${balance > 0 ? 'text-green-600' : balance < 0 ? 'text-red-600' : 'text-gray-600'}`}>
                                                {balance > 0 ? '+' : ''}â‚¹{balance.toFixed(2)}
                                            </span>
                                        </div>
                                    ))}
                                </div>
                            </div>

                            <div className="bg-white rounded-lg shadow-lg p-6">
                                <h2 className="text-xl font-semibold mb-4">Settlements</h2>
                                <div className="space-y-2">
                                    {settlements.length === 0 ? (
                                        <p className="text-gray-500 text-center py-8">All settled up! ðŸŽ‰</p>
                                    ) : (
                                        settlements.map((settlement, idx) => (
                                            <div key={idx} className="p-3 bg-amber-50 border border-amber-200 rounded-lg">
                                                <span className="font-medium">{settlement.from}</span>
                                                {' â†’ '}
                                                <span className="font-medium">{settlement.to}</span>
                                                <span className="float-right font-bold text-amber-600">
                                                    â‚¹{settlement.amount}
                                                </span>
                                            </div>
                                        ))
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<TripExpenseSplitter />, document.getElementById('root'));
    </script>
</body>
</html>